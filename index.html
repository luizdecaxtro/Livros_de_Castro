<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Livros de Castro - Sistema de Leitura</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .book-page { 
            background: linear-gradient(145deg, #f9f9f9 0%, #ffffff 100%);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .protected-content {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        .no-print { -webkit-print-color-adjust: exact; }
        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Tela de Login -->
    <div id="loginScreen" class="min-h-screen bg-gray-100 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-lg p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="flex items-center justify-center mb-4">
                    <i data-lucide="book-open" class="h-12 w-12 text-blue-600 mr-2"></i>
                    <i data-lucide="github" class="h-10 w-10 text-gray-700"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-900 mb-2">Livros de Castro</h1>
                <p class="text-gray-600">Sistema de leitura protegida - Reposit√≥rio: Livros_de_Castro</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        C√≥digo do Livro
                    </label>
                    <input
                        type="text"
                        id="bookCode"
                        placeholder="CASTRO001"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-center text-lg uppercase"
                    />
                </div>
                
                <button
                    onclick="openBook()"
                    class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors flex items-center justify-center"
                >
                    <i data-lucide="book-open" class="h-4 w-4 mr-2"></i>
                    Abrir Livro
                </button>
            </div>
            
            <div class="mt-6">
                <div class="p-4 bg-blue-50 rounded-md">
                    <p class="text-sm text-blue-800 font-medium mb-3 text-center">üìö Livros Dispon√≠veis</p>
                    <div class="space-y-2" id="booksList">
                        <!-- Livros ser√£o inseridos via JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tela do Leitor -->
    <div id="readerScreen" class="min-h-screen bg-gray-900 flex-col hidden">
        <header class="bg-gray-800 border-b border-gray-700">
            <div class="px-4 py-3">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <button onclick="backToLogin()" class="text-gray-300 hover:text-white">
                            <i data-lucide="chevron-left" class="h-5 w-5"></i>
                        </button>
                        <div class="flex items-center">
                            <i data-lucide="lock" class="h-4 w-4 text-green-400 mr-2"></i>
                            <span class="text-white font-medium" id="bookTitle">Carregando...</span>
                            <span class="text-gray-400 text-sm ml-2" id="bookCodeHeader">(...)</span>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2 bg-gray-700 rounded px-3 py-1">
                            <button onclick="changeZoom(-10)" class="text-gray-300 hover:text-white">
                                <i data-lucide="zoom-out" class="h-4 w-4"></i>
                            </button>
                            <span class="text-white text-xs px-2" id="zoomLevel">100%</span>
                            <button onclick="changeZoom(10)" class="text-gray-300 hover:text-white">
                                <i data-lucide="zoom-in" class="h-4 w-4"></i>
                            </button>
                        </div>
                        
                        <div class="text-xs text-gray-400 text-right">
                            <div>Sess√£o protegida</div>
                            <div id="sessionTimer">3h 0min</div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <main class="flex-1 flex">
            <div class="flex-1 flex items-center justify-center p-4 bg-gray-800">
                <!-- Loading indicator -->
                <div id="loadingIndicator" class="text-white text-center hidden">
                    <div class="animate-spin h-8 w-8 border-2 border-white border-t-transparent rounded-full mx-auto mb-4"></div>
                    <p>Carregando livro...</p>
                </div>
                
                <!-- PDF Canvas Container -->
                <div class="book-page protected-content relative" id="pdfContainer" style="transform: scale(1); max-width: 90%; max-height: 90%; overflow: hidden;">
                    <canvas id="pdfCanvas" class="shadow-lg"></canvas>
                    
                    <!-- Overlay de prote√ß√£o -->
                    <div class="absolute inset-0 bg-transparent"></div>
                    
                    <!-- Info overlay -->
                    <div class="absolute top-4 left-4 bg-black bg-opacity-50 text-white px-3 py-2 rounded text-sm">
                        <div id="pageInfo">P√°gina 1 de 245</div>
                        <div class="text-xs opacity-75">Livros de Castro - <span id="bookCodeOverlay">---</span></div>
                    </div>
                    
                    <!-- Protection watermark -->
                    <div class="absolute bottom-4 right-4 bg-red-500 bg-opacity-20 text-red-200 px-2 py-1 rounded text-xs">
                        üîí Protegido - Sess√£o: <span id="sessionWatermark">3h 0min</span>
                    </div>
                </div>
            </div>
            
            <div class="w-16 bg-gray-800 border-l border-gray-700 flex flex-col items-center py-4 space-y-4">
                <button onclick="previousPage()" id="prevButton" class="text-gray-300 hover:text-white p-2 rounded">
                    <i data-lucide="chevron-left" class="h-5 w-5"></i>
                </button>
                
                <div class="text-white text-xs text-center" id="pageNavigation">
                    <span id="currentPage">1</span><br/>de<br/><span id="totalPages">245</span>
                </div>
                
                <button onclick="nextPage()" id="nextButton" class="text-gray-300 hover:text-white p-2 rounded">
                    <i data-lucide="chevron-right" class="h-5 w-5"></i>
                </button>
            </div>
        </main>
        
        <div class="bg-gray-800 border-t border-gray-700 px-4 py-2 no-print">
            <div class="flex items-center justify-center space-x-4 text-xs text-gray-400">
                <span>üîê Reposit√≥rio: Livros_de_Castro</span>
                <span>‚Ä¢</span>
                <span>üì± Livro: <span id="footerBookCode">---</span></span>
                <span>‚Ä¢</span>
                <span>‚è±Ô∏è Auto-logout em <span id="footerTimer">3h 0min</span></span>
            </div>
        </div>
    </div>

    <script>
        // Base de dados dos livros
        const bookDatabase = {
            'CASTRO001': { title: 'Poemas', pages: 120, file: 'livros/Poemas.pdf' },
            'CASTRO002': { title: 'Palavras que Libertam', pages: 89, file: 'livros/Palavras-que-Libertam.pdf' },
            'CASTRO003': { title: 'O Pentateuco', pages: 345, file: 'livros/O-Pentateuco.pdf' },
            'CASTRO004': { title: 'O Poder da Intelig√™ncia Artificial', pages: 198, file: 'livros/O-Poder-da-Inteligencia-Artificial.pdf' },
            'CASTRO005': { title: 'Os Caminhos do Cora√ß√£o', pages: 156, file: 'livros/Os-Caminhos-do-Coracao.pdf' },
            'CASTRO006': { title: 'Mentores Espirituais', pages: 203, file: 'livros/Mentores-Espirituais.pdf' },
            'CASTRO007': { title: 'Elara, e as Conex√µes Para a Liberdade', pages: 267, file: 'livros/Elara-e-as-Conexoes-Para-a-Liberdade.pdf' },
            'CASTRO008': { title: 'O Bem e o Mal', pages: 134, file: 'livros/O-Bem-e-o-Mal.pdf' }
        };

        let currentBook = null;
        let currentPage = 1;
        let zoom = 100;
        let sessionTime = 180; // 3 horas em minutos
        let pdfDoc = null;
        let canvas = null;
        let ctx = null;
        
        // Configurar PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // Inicializar p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            loadBooksList();
            startSessionTimer();
            
            // Inicializar canvas
            canvas = document.getElementById('pdfCanvas');
            ctx = canvas.getContext('2d');
            
            // Prote√ß√£o contra c√≥pia
            document.addEventListener('contextmenu', e => e.preventDefault());
            document.addEventListener('selectstart', e => e.preventDefault());
            document.addEventListener('dragstart', e => e.preventDefault());
        });

        // Carregar lista de livros
        function loadBooksList() {
            const booksList = document.getElementById('booksList');
            booksList.innerHTML = '';
            
            Object.entries(bookDatabase).forEach(([code, book]) => {
                const bookDiv = document.createElement('div');
                bookDiv.className = 'flex flex-col bg-white p-3 rounded border cursor-pointer hover:bg-gray-50';
                bookDiv.onclick = () => {
                    document.getElementById('bookCode').value = code;
                    openBook();
                };
                
                bookDiv.innerHTML = `
                    <div class="font-medium text-blue-900">${code}</div>
                    <div class="text-sm text-blue-700">${book.title}</div>
                    <div class="text-xs text-blue-600">${book.pages} p√°ginas</div>
                `;
                
                booksList.appendChild(bookDiv);
            });
        }

        // Carregar PDF
        async function loadPDF(pdfPath) {
            try {
                document.getElementById('loadingIndicator').classList.remove('hidden');
                document.getElementById('pdfContainer').classList.add('hidden');
                
                const loadingTask = pdfjsLib.getDocument(pdfPath);
                pdfDoc = await loadingTask.promise;
                
                document.getElementById('loadingIndicator').classList.add('hidden');
                document.getElementById('pdfContainer').classList.remove('hidden');
                
                // Atualizar n√∫mero real de p√°ginas
                currentBook.pages = pdfDoc.numPages;
                document.getElementById('totalPages').textContent = currentBook.pages;
                
                renderPage(currentPage);
                return true;
            } catch (error) {
                console.error('Erro ao carregar PDF:', error);
                document.getElementById('loadingIndicator').classList.add('hidden');
                alert('Erro ao carregar o livro. Verifique se o arquivo PDF existe no reposit√≥rio.');
                return false;
            }
        }

        // Renderizar p√°gina do PDF
        async function renderPage(pageNum) {
            if (!pdfDoc) return;
            
            try {
                const page = await pdfDoc.getPage(pageNum);
                const viewport = page.getViewport({ scale: zoom / 100 });
                
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                
                // Limpar canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Renderizar p√°gina
                const renderContext = {
                    canvasContext: ctx,
                    viewport: viewport
                };
                
                await page.render(renderContext).promise;
                updatePageInfo();
                
            } catch (error) {
                console.error('Erro ao renderizar p√°gina:', error);
            }
        }

        // Abrir livro
        async function openBook() {
            const bookCode = document.getElementById('bookCode').value.toUpperCase().trim();
            
            if (!bookDatabase[bookCode]) {
                alert('C√≥digo do livro inv√°lido!');
                return;
            }
            
            currentBook = bookDatabase[bookCode];
            currentPage = 1;
            
            // Atualizar interface
            document.getElementById('bookTitle').textContent = currentBook.title;
            document.getElementById('bookCodeHeader').textContent = `(${bookCode})`;
            document.getElementById('footerBookCode').textContent = bookCode;
            document.getElementById('bookCodeOverlay').textContent = bookCode;
            document.getElementById('totalPages').textContent = currentBook.pages;
            
            // Trocar telas
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('readerScreen').classList.remove('hidden');
            document.getElementById('readerScreen').classList.add('flex');
            
            // Carregar PDF real
            const pdfLoaded = await loadPDF(currentBook.file);
            if (!pdfLoaded) {
                backToLogin();
            }
        }

        // Voltar para login
        function backToLogin() {
            document.getElementById('readerScreen').classList.add('hidden');
            document.getElementById('readerScreen').classList.remove('flex');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('bookCode').value = '';
            currentBook = null;
        }

        // Navega√ß√£o de p√°ginas
        function nextPage() {
            if (currentBook && currentPage < currentBook.pages) {
                currentPage++;
                renderPage(currentPage);
            }
        }

        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                renderPage(currentPage);
            }
        }

        // Controle de zoom
        function changeZoom(delta) {
            zoom = Math.max(50, Math.min(200, zoom + delta));
            document.getElementById('zoomLevel').textContent = zoom + '%';
            document.getElementById('pdfContainer').style.transform = `scale(${zoom / 100})`;
            
            // Re-renderizar com novo zoom
            if (pdfDoc) {
                renderPage(currentPage);
            }
        }

        // Atualizar informa√ß√µes da p√°gina
        function updatePageInfo() {
            if (!currentBook) return;
            
            document.getElementById('currentPage').textContent = currentPage;
            document.getElementById('pageInfo').textContent = `P√°gina ${currentPage} de ${currentBook.pages}`;
            
            // Atualizar bot√µes
            const prevButton = document.getElementById('prevButton');
            const nextButton = document.getElementById('nextButton');
            
            prevButton.disabled = currentPage === 1;
            nextButton.disabled = currentPage === currentBook.pages;
            
            if (currentPage === 1) {
                prevButton.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                prevButton.classList.remove('opacity-50', 'cursor-not-allowed');
            }
            
            if (currentPage === currentBook.pages) {
                nextButton.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                nextButton.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        // Timer da sess√£o
        function startSessionTimer() {
            setInterval(() => {
                if (sessionTime > 0) {
                    sessionTime--;
                    const hours = Math.floor(sessionTime / 60);
                    const minutes = sessionTime % 60;
                    const timeText = `${hours}h ${minutes}min`;
                    
                    document.getElementById('sessionTimer').textContent = timeText;
                    document.getElementById('sessionWatermark').textContent = timeText;
                    document.getElementById('footerTimer').textContent = `Auto-logout em ${timeText}`;
                } else {
                    alert('Sess√£o expirada!');
                    backToLogin();
                    sessionTime = 180; // Resetar
                }
            }, 60000); // Atualizar a cada minuto
        }

        // Prote√ß√µes de seguran√ßa
        document.addEventListener('keydown', function(e) {
            // Bloquear Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+S, Ctrl+P, F12
            if ((e.ctrlKey && ['a', 'c', 'v', 's', 'p'].includes(e.key.toLowerCase())) || e.key === 'F12') {
                e.preventDefault();
            }
        });
    </script>
</body>
</html>
